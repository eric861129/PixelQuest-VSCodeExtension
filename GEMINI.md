# GEMINI.md - PixelQuest VS Code Extension

This file provides context and guidelines for Gemini CLI interactions within the PixelQuest project.

## üöÄ Project Overview
**PixelQuest** is a VS Code extension that transforms terminal activities from AI Agents (like Gemini CLI, Claude Code, and Codex) into a pixel-art RPG visual experience. It monitors real-time terminal data to identify specific agent actions and synchronizes them with game states in the sidebar.

### üõ†Ô∏è Tech Stack
- **Language**: TypeScript
- **Platform**: VS Code Extension (Targeting v1.85.0+)
- **Proposed API**: `terminalDataWriteEvent` (Requires `vscode.proposed.terminalDataWriteEvent.d.ts`)
- **UI**: Webview (HTML/CSS/JS)
- **I18n**: Support for English (default) and Traditional Chinese (`src/i18n.ts`)

## üèóÔ∏è Architecture
- **`src/extension.ts`**: Main entry point. Orchestrates the registry, monitor, and view provider.
- **`src/TerminalMonitor.ts`**: Core logic for intercepting terminal streams, stripping ANSI escape sequences, and buffering lines.
- **`src/agents/`**:
  - `types.ts`: Defines `AgentState` (`IDLE`, `THINKING`, `WORKING`, `SUCCESS`, `FAILURE`) and the `IAgentMapper` interface.
  - `AgentRegistry.ts`: Decouples agent detection from action mapping.
  - `GeminiMapper.ts`: Concrete implementation for Gemini CLI keyword detection.
- **`src/PixelQuestViewProvider.ts`**: Manages the Webview lifecycle and UI updates.

## üíª Development Workflow

### Building & Running
- **Compile**: `npm run compile` (Uses `tsc`)
- **Watch**: `npm run watch` (Useful during development)
- **Lint**: `npm run lint` (ESLint)
- **Debug**: Press `F5` in VS Code to launch the **Extension Development Host**.

### Testing
- **Run Tests**: `npm run test` (Uses `@vscode/test-electron` and Mocha)
- **Test Suite Location**: `src/test/suite/`
  - `agentRegistry.test.ts`: Validates agent detection and mapping logic.
  - `terminalMonitor.test.ts`: Tests ANSI stripping and data buffering.

## üìù Conventions
- **Action Mapping**: All new AI Agents must implement the `IAgentMapper` interface in `src/agents/types.ts` and be registered in `src/extension.ts`.
- **UI Communication**: Data is sent to the Webview using `webview.postMessage({ type: 'update', ... })`.
- **Error Handling**: Use the `FAILURE` state to represent errors captured in the terminal.
- **Performance**: Keep `TerminalMonitor` logic lean to avoid terminal lag.

## üó∫Ô∏è Roadmap
1. **Multi-Agent Expansion**: Add full support for `Claude Code` and `Codex`.
2. **Visual Upgrade**: Move from text-based PoC to HTML5 Canvas-based Sprite animation.
3. **Custom Actions**: Allow users to map their own terminal commands to RPG actions.

---
*Generated by Gemini CLI for PixelQuest Development.*
