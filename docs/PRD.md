# 產品需求文件 (PRD)：PixelQuest VS Code Extension

## 1. 產品概述

**PixelQuest** 是一款開源的 VS Code 延伸模組，旨在將 **GeminiCLI** 的終端機執行過程轉化為一場「像素風格的 RPG 戰鬥」。當使用者在 VS Code 終端機調用 GeminiCLI 執行任務時，側邊欄或狀態欄會同步出現像素角色，根據任務的規模與性質進行戰鬥動作，直到任務完成（Boss 擊敗）。

## 2. 目標使用者

* 頻繁使用 GeminiCLI 進行程式碼生成、重構或自動化任務的開發者。
* 喜愛像素藝術 (Pixel Art) 與 RPG 遊戲元素的技術愛好者。

## 3. 核心功能需求

### 3.1 任務即時監測 (Core Logic)

* **啟動觸發**：監測終端機輸入，當識別到 `gemini-cli` (或相關指令) 啟動時，啟動戰鬥介面。
* **狀態判斷**：
* **任務規模 (Task Scale)**：根據指令參數或預計輸出的長度判斷（例如：單一檔案修改 vs 專案級重構）。
* **任務類型 (Type Recognition)**：識別是 `Debug`（施法解咒）、`Refactor`（連擊）、`New Feature`（大招啟動）。

這是一個非常棒的點子！將開發過程中的「指令」對應到「RPG 遊戲行為」，能讓這款套件的趣味性與代入感大幅提升。

作為產品經理，我將這些開發任務與 RPG 動作進行了深度對應，並整理成下方的**「開發任務對應表」**，這將作為 PRD 的核心邏輯文件之一，交給 GeminiCLI 開發時，它就能根據這些關鍵字來切換像素動畫。

---

### 🎮 開發任務與 RPG 動作對應表

| 開發任務 (Task)    | 偵測關鍵字 (Keywords)         | RPG 遊戲動作 (Game Action)        | 視覺表現描述                                               |
| ------------------ | ----------------------------- | --------------------------------- | ---------------------------------------------------------- |
| **Git 提交與推送** | `git commit`, `git push`      | **存檔點 (Save Point)**           | 角色走到女神像前或營火旁，頭頂出現「Saving...」或光芒。    |
| **依賴安裝**       | `npm install`, `yarn`, `pnpm` | **購買裝備/道具 (Shopping)**      | 出現一個武器商人 NPC，角色正在挑選武器或背起大包包。       |
| **單元測試**       | `npm test`, `jest`, `vitest`  | **競技場練習 (Sparring)**         | 角色與木頭假人或練習小妖對打，跳出大量的「Combo」數。      |
| **修復錯誤 (Fix)** | `fix`, `debug`, `patch`       | **施放解咒術 (Dispel)**           | 角色對著受傷的隊友（程式碼）施放淨化魔法或喝下解毒藥水。   |
| **重構代碼**       | `refactor`                    | **鍛造合成 (Crafting)**           | 出現鐵砧，角色正在敲打武器，試圖讓裝備屬性（品質）變更好。 |
| **專案初始化**     | `init`, `create-app`          | **序章開啟 (New Game)**           | 角色從村莊家門口出發，背起行囊，畫面上方出現「Level 1」。  |
| **代碼檢索/解釋**  | `list`, `search`, `explain`   | **查閱地圖/百科 (Map/Lore)**      | 角色打開一份巨大的地圖或翻閱厚重的魔法書進行尋找。         |
| **部署/發佈**      | `deploy`, `publish`           | **前往下一個地圖 (Travel)**       | 角色跳上飛空艇、馬車，或是穿過傳送門離開當前區域。         |
| **代碼衝突**       | `conflict`, `merge abort`     | **陷入異常狀態 (Status Ailment)** | 角色進入混亂 (Confuse) 或中毒狀態，頭上出現旋轉的小鳥。    |

---

### 🛠 針對 GeminiCLI 開發的 PRD 補充：邏輯判斷規則

為了讓 GeminiCLI 工程師知道如何實作，我們在 PRD 中加入以下邏輯定義：

1. **關鍵字權重引擎 (Keyword Engine)**：
* 套件需建立一個 `ActionMapper` 字典，優先比對指令首詞（如 `git`, `npm`），再比對後續參數。
* **Fallback 機制**：若指令不在清單中，統一歸類為「普通戰鬥 (Generic Attack)」。


2. **任務時長與 Boss 等級 (Duration & Boss Logic)**：
* **快速任務 (< 5s)**：如 `git commit`。顯示小怪（史萊姆），角色一擊必殺後直接跳出「Success!」。
* **長任務 (> 10s)**：如 `npm install`。顯示 Boss 等級（巨龍），血條長度與安裝進度百分比 (if available) 或時間正相關。


3. **結局分支 (Ending Branch)**：
* **Exit Code 0 (成功)**：Boss 倒地，噴出金幣與寶箱，角色做出「Victory Pose」。
* **Exit Code 非 0 (失敗)**：Boss 施放全屏大招，角色倒地 (K.O.)，畫面變灰並提示「Mission Failed」。


### 3.2 戰鬥視覺系統 (Visual System)

* **角色動畫**：
* **Idle 狀態**：GeminiCLI 準備中。
* **Attack 狀態**：終端機持續輸出文字時。
* **Hit 狀態**：當偵測到錯誤 (Error) 或重試 (Retry) 時，角色受傷。


* **Boss 系統**：
* **小型 Boss (Slime/Goblin)**：對應簡單指令（如：解釋程式碼）。
* **大型 Boss (Dragon/Demon)**：對應複雜指令（如：生成整個模組）。


* **血條同步**：Boss 血條扣減與 GeminiCLI 的任務進度（或輸出行數）成正比。

### 3.3 介面呈現 (UI/UX)

* **Webview Panel**：在 VS Code 側邊欄 (Sidebar) 提供獨立的像素畫布。
* **零 Token 消耗**：所有判斷邏輯皆在本地端完成，不額外呼叫 AI API。

---

## 4. 產品結構圖 (System Architecture)

---

## 5. 技術規格與開發階段

| 階段                     | 任務重點                                            | 預期成果                                           |
| ------------------------ | --------------------------------------------------- | -------------------------------------------------- |
| **第一階段：基礎建設**   | 建立 VS Code Extension 模板，串接終端機監聽器。     | 能在終端機輸入時，於 Webview 顯示「Hello Pixel」。 |
| **第二階段：邏輯引擎**   | 開發 Regex 引擎，解析 GeminiCLI 的輸出流 (Stdout)。 | 根據文字量動態減少 Boss 血量。                     |
| **第三階段：視覺開發**   | 整合像素 Sprite 圖資，實現動畫切換邏輯。            | 角色會隨著終端機跳動而揮劍。                       |
| **第四階段：優化與開源** | 配置檔設定（自定義角色）、開源授權文件準備。        | 發佈至 VS Code Marketplace。                       |

---

## 6. 非功能性需求

* **效能**：Webview 渲染不得佔用超過 5% 的 CPU，避免影響開發體驗。
* **相容性**：支援 Windows/macOS/Linux 的 VS Code 環境。
* **擴充性**：允許使用者未來能透過資料夾放入自己的 `.gif` 或 `.png` 像素序列幀。

